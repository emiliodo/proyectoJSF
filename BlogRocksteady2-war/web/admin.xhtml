<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"      
      xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
      xmlns:f="http://xmlns.jcp.org/jsf/core">
    <h:head>

        <title>Blog - Rocksteady Blog</title>
        <h:outputStylesheet library="css" name="style.css"  />
        <meta http-equiv="content-type" content="text/html; charset=utf-8" />
        <meta name="description" content="" />
        <meta name="keywords" content="" />
        <script src="http://fonts.googleapis.com/css?family=Oxygen:400,300,700"/>
        <h:outputStylesheet library="css" name="skel-noscript.css"  />
        <!--[if lte IE 8]><h:outputScript library="js" name="js/html5shiv.js"/><![endif]-->
        <h:outputScript library="js" name="skel.min.js"/>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"/>
        <h:outputScript library="js" name="skel-panels.min.js"/>
        <h:outputScript library="js" name="init.js"/>


        <!--[if lte IE 8]><h:outputStylesheet library="css" name="css/ie/v8.css"/><![endif]-->
        <!--[if lte IE 9]><h:outputStylesheet library="css" name="css/ie/v9.css"/><![endif]-->
    </h:head>
    <h:body>
        <!-- Header -->
        <div id="header">
            <div class="container">

                <!-- Logo -->
                <div id="logo">
                    <h1><a>Rocksteady</a></h1>
                    <span>BLOG</span>
                </div>

                <!-- Nav -->
                <!-- Mezclamos tags jsf con c:if  para no crear muchos h:panelGroup -->
                <nav id="nav">
                    <ul>
                        <li>
                            <h:link value="Home" outcome="index" />
                        </li>

                        <li>
                            <h:link value="Blog" outcome="blog" />
                        </li>
                        <c:if test="#{not empty sessionBean.user}">
                            <li>
                                <h:link value="Sign Up" outcome="signUp"/>
                            </li>
                        </c:if>

                        <c:if test="#{not empty sessionBean.user}">
                            <!-- uso el c:if u no el rendered como condición para mostrar el enlace ya que al estar siempre 
                            el <li> aparecería un elemento vacío en caso de no cumplirse la condición -->
                            <c:if test="#{sessionBean.user.userType == BigInteger.valueOf(1)}">
                                <li>
                                    <h:link value="Admin" outcome="admin" rendered="#{sessionBean.user.userType == BigInteger.valueOf(1)}"/>
                                </li>
                            </c:if>
                            <li>
                                <h:link value="Edit Profile" outcome="editProfile" />
                            </li>
                            <li>
                                <h:link value="Log Out" outcome="logout" />
                            </li>
                        </c:if>
                    </ul>
                </nav>

            </div>
        </div>
        <!-- Header -->

        <!-- Main -->
        <div id="main">
            <div class="container">
                <header>
                    <center>
                        <h2>#{msg['Hello']}
                            <font color="orange">
                                #{sessionBean.user.username}
                                <br/><br/>
                            </font>
                        </h2>
                    </center>
                </header>
                <div class="row">

                    <div class="3u">
                        <section>
                            <h:form>
                                <legend>
                                    <b>#{msg['EditUsers']}</b>
                                </legend>
                                #{msg['FilterBy']}:<br/>
                                <h:inputText value="#{adminUserBean.userFilter}"/>
                                <br/>
                                <h:commandButton value="#{msg['findUsers']}" action="#{adminUserBean.doSearchUsersByNameContaining()}"/>
                            </h:form>


                        </section>
                    </div>
                    <div class="3u">
                        <section>
                            <h:form>

                                <legend><b>#{msg['DeletePost']}</b></legend>
                                #{msg['FromUser']}:<br/>
                                <h:inputText value="#{adminPostBean.userFilter}"/>
                                <br/>
                                <h:commandButton value="#{msg['FindPostByUser']}" action="#{adminPostBean.doSearchPostsByUser()}"/>
                            </h:form>
                        </section>
                    </div>
                    <div class="3u">
                        <section>
                            <h:form>

                                <legend><b>#{msg['DeleteComment']}</b></legend>
                                #{msg['FromUser']}:<br/>
                                <h:inputText value="#{adminCommentBean.userFilter}"/>
                                <br/>
                                <h:commandButton value="#{msg['findComment']}" action="#{adminCommentBean.doSearchCommentsByUser()}"/>

                            </h:form>
                        </section>
                    </div>
                    <div class="3u">
                        <section>
                            <h:form>

                                <legend><b>#{msg['selectMVPost']}</b></legend>
                                <br/><br/>
                                <h:commandButton value="#{msg['getPosts']}" action="#{adminPostBean.doListPostsForMVP()}"/>
                            </h:form>
                        </section>
                    </div>
                </div>



                <!-- SEARCH RESULTS: -->

                <h:panelGroup rendered="#{ empty adminUserBean.userList and 
                                           empty adminPostBean.postList and 
                                           empty adminCommentBean.commentList and
                                           (adminUserBean.searchPerformed or
                                           adminCommentBean.searchPerformed or
                                           adminPostBean.searchPerformed)}">
                    <br/><br/>
                    <header>
                        <center>
                            <h2><font color="red">#{msg['noResultsFound']}</font></h2></center>
                    </header>
                </h:panelGroup>

                <h:panelGroup rendered="#{not empty adminUserBean.userList and adminUserBean.searchPerformed}">
                    <br/><br/>
                    <header>
                        <center>
                            <h2><font color="green">#{msg['usersFound']}:</font></h2>
                        </center>
                    </header>
                    <h:dataTable style="width:100%" value="#{adminUserBean.userList}"
                                 var="usersFound">
                        <h:column>
                            <!-- column header -->
                            <f:facet name="header"><b>#{msg['Username']}</b></f:facet>
                            <!-- row record -->
                            #{usersFound.username}
                        </h:column>
                        <h:column>
                            <!-- column header -->
                            <f:facet name="header"><b>#{msg['UserType']}</b></f:facet>
                            <!-- row record -->
                            #{usersFound.userTypeToText()}
                        </h:column>
                        <h:column>
                            <!-- column header -->
                            <f:facet name="header"><b>#{msg['performAction']}</b></f:facet>
                            <!-- row record -->
                            <h:panelGroup rendered="#{sessionBean.user.userId ne usersFound.userId}">
                                <h:form>
                                    <h:selectOneMenu value="Select action..." onchange="submit()" 
                                                     valueChangeListener="#{adminUserBean.actionUserEditActionPerformed}">
                                        <f:selectItem id="item1" itemLabel="#{msg['selectOption']}" itemValue="" />
                                        <f:selectItem id="item2" itemLabel="#{msg['setAdmin']}" itemValue="Admin#{usersFound.userId}" />
                                        <f:selectItem id="item3" itemLabel="#{msg['setWriter']}" itemValue="Writer#{usersFound.userId}" />
                                        <f:selectItem id="item4" itemLabel="#{msg['setRegistered']}" itemValue="Registered#{usersFound.userId}" />

                                    </h:selectOneMenu>
                                </h:form>
                            </h:panelGroup>
                            <h:panelGroup rendered="#{sessionBean.user.userId eq usersFound.userId}">
                                <font color="red">
                                    #{msg['itsme']}.
                                </font>
                            </h:panelGroup>
                        </h:column>
                    </h:dataTable>
                </h:panelGroup>

                <h:panelGroup rendered="#{not empty adminPostBean.postList and !adminPostBean.setMVP}">
                    <br/><br/>
                    <header>
                        <center>
                            <h2>
                                <font color="green">#{msg['PostList']}:</font>
                            </h2>
                        </center>
                    </header>
                    
                    <h:dataTable value="#{adminPostBean.postList}"
                                 var="postsFound">
                        <h:column>
                            <li><b> #{postsFound.title}}</b>
                                <br/>
                                #{postsFound.postDate}
                            </li>
                            <h:form>
                                <h:commandButton value="#{msg['DeletePost']}" action="#{adminPostBean.doDeletePostWithID(postsFound.postId)}"/>
                            </h:form>

                        </h:column>
                    </h:dataTable>
                </h:panelGroup>

                <h:panelGroup rendered="#{not empty adminPostBean.postList and adminPostBean.setMVP}">
                    <br/><br/>
                    <header>
                        <center><h2><font color="green">#{msg['selectPostToMakeMVP']}:</font></h2></center>
                    </header>
                    <h:dataTable value="#{adminPostBean.postList}"
                                 var="postsFoundMVP">
                        <h:column>
                            <li><b> #{postsFoundMVP.title}</b>
                                <br/>
                                #{postsFoundMVP.postDate}
                            </li>
                            <h:form>
                                <h:commandButton value="#{msg['MakeMVP']}" action="#{adminPostBean.doMakeMVP(postsFoundMVP.postId)}"/>
                            </h:form>
                            <br/>
                        </h:column>
                    </h:dataTable>
                </h:panelGroup>

                <h:panelGroup rendered="#{not empty adminCommentBean.commentList and adminCommentBean.searchPerformed}">
                    <br/><br/>
                    <header>
                        <center><h2><font color="green">#{msg['CommentsFound']}:</font></h2></center>
                    </header>
                    <h:dataTable value="#{adminCommentBean.commentList}"
                                 var="commentsFound">
                        <h:column>
                            <li>#{commentsFound.commentContent}
                                <h:form>
                                    <h:commandButton value="#{msg['DeleteComment']}" action="#{adminCommentBean.doDeleteCommentPostWithID(commentsFound.commentId)}"/>
                                </h:form> 
                            </li>
                        </h:column>
                    </h:dataTable>

                </h:panelGroup>

                <!-- SEARCH RESULTS -->
            </div>
        </div>
        <!-- Main -->


        <!-- Copyright -->
        <div id="copyright">
            Trabajo Java EE - Máster INFTEL
        </div>
    </h:body>
</html>

